FountainOutlineView = require '../lib/fountain-outline-view'
fs = require 'fs'
_ = require 'underscore-plus'
path = require 'path'

describe 'Fountain Outline View', ->

  SCENE_LIST = [{"line":12,"title":"EXT. BRICK\'S PATIO - DAY","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":52},{"line":52,"title":"INT. TRAILER HOME - DAY","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":69},{"line":69,"title":"EXT. BRICK\'S POOL - DAY","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":80},{"line":80,"title":"SNIPER SCOPE POV","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":95},{"line":95,"title":"OPENING TITLES","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":105},{"line":105,"title":"EXT. WOODEN SHACK - DAY","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":129},{"line":129,"title":"INT. GARAGE - DAY","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":144},{"line":144,"title":"EXT. PALATIAL MANSION - DAY","type":"scene","hasNote":false,"depth":0,"parentEndline":161,"endline":161}]
  FORMATTED_SCENE_LIST = '<li class="outline-item scene depth-0" data-line="12" end-line="52"><span class="icon icon-text">EXT. BRICK\'S PATIO - DAY</span></li><li class="outline-item scene depth-0" data-line="52" end-line="69"><span class="icon icon-text">INT. TRAILER HOME - DAY</span></li><li class="outline-item scene depth-0" data-line="69" end-line="80"><span class="icon icon-text">EXT. BRICK\'S POOL - DAY</span></li><li class="outline-item scene depth-0" data-line="80" end-line="95"><span class="icon icon-text">SNIPER SCOPE POV</span></li><li class="outline-item scene depth-0" data-line="95" end-line="105"><span class="icon icon-text">OPENING TITLES</span></li><li class="outline-item scene depth-0" data-line="105" end-line="129"><span class="icon icon-text">EXT. WOODEN SHACK - DAY</span></li><li class="outline-item scene depth-0" data-line="129" end-line="144"><span class="icon icon-text">INT. GARAGE - DAY</span></li><li class="outline-item scene depth-0" data-line="144" end-line="161"><span class="icon icon-text">EXT. PALATIAL MANSION - DAY</span></li>'
  SCENE_TYPE_LIST = _.where(SCENE_LIST, {type: 'scene'} )

  beforeEach ->
    # Ensure you're language package is loaded
    waitsForPromise ->
      atom.packages.activatePackage 'fountain'

  # sanity checks
  it 'should have loaded fountain package', ->
    expect(atom.packages.isPackageActive('fountain')).toBeTruthy()


  describe 'formatting', ->

    @fov
    @fileText

    beforeEach ->
      @fov = new FountainOutlineView()
      packagePath = atom.packages.resolvePackagePath('fountain')
      fileToRead = path.join(packagePath, 'spec/test_files/outline-view-tests.fountain')
      @fileText = fs.readFileSync(fileToRead, 'utf8')

    it 'should have text', ->
      expect(@fileText).toBeTruthy()

    it 'should have FOV object', ->
      expect(@fov).toBeDefined()

    it 'should find expected scenes', ->
      expect(@fov.findScenes(@fileText)).toEqual(SCENE_LIST)

    it 'should generate expected html', ->
      expect(@fov.formatList('', SCENE_LIST)).toEqual(FORMATTED_SCENE_LIST)


  describe 'reordering', ->

    @fov
    @fileText
    @fileLines

    beforeEach ->
      @fov = new FountainOutlineView()
      packagePath = atom.packages.resolvePackagePath('fountain')
      fileToRead = path.join(packagePath, 'spec/test_files/outline-view-tests.fountain')
      @fileText = fs.readFileSync(fileToRead, 'utf8')
      @fileLines = @fileText.split('\n')

    it 'should be able to get oldLineIndexes', ->
      # mocking first scene initial drag event
      mockedMovingElement = {oldIndex: 0, newIndex: undefined, item: attributes: [null, {value: "12"}, {value: "52"}]}
      [startLine, endLine] = @fov.getOldLineIndexes(@fileLines, SCENE_TYPE_LIST, mockedMovingElement)
      expect(startLine).toEqual(12)
      expect(endLine).toEqual(52)

    it 'should be able to get oldLineIndexes for last scene', ->
      # mocking first scene initial drag event
      linesInFile = 161
      mockedMovingElement = {oldIndex: 7, newIndex: undefined, item: attributes: [null, {value: "144"}, {value: "161"}]}
      [startLine, endLine] = @fov.getOldLineIndexes(@fileLines, SCENE_TYPE_LIST, mockedMovingElement)
      expect(startLine).toEqual(144)
      expect(endLine).toEqual(linesInFile)

    it 'should be able to get newStartLineIndex before current', ->
      startLine = @fov.getNewStartLineIndex(@fileLines, SCENE_TYPE_LIST, 5, 3)
      expect(startLine).toEqual(80)

    it 'should be able to get newStartLineIndex after current', ->
      startLine = @fov.getNewStartLineIndex(@fileLines, SCENE_TYPE_LIST, 3, 5)
      # this index is grabbed before the index shift is calculated
      expect(startLine).toEqual(129)

    it 'should be able to get newStartLineIndex at last index', ->
      lastIndexInFileArray = 161
      startLine = @fov.getNewStartLineIndex(@fileLines, SCENE_TYPE_LIST, 5, 7)
      expect(startLine).toEqual(lastIndexInFileArray)

    it 'should be able to swap from beginning and keep same number of lines', ->
      # swap 0 to 1
      newText = @fov.getNewFileText(@fileLines, 12, 52, 69)
      expect(newText.split('\n').length).toEqual(@fileLines.length)

    it 'should be able to swap from end and keep same number of lines', ->
      # swap 7 to 6
      newText = @fov.getNewFileText(@fileLines, 144, @fileLines.length, 129)
      expect(newText.split('\n').length).toEqual(@fileLines.length)

    it 'should be able to swap from middle and keep same number of lines', ->
      # swap 2 to 6
      newText = @fov.getNewFileText(@fileLines, 69, 80, 144)
      expect(newText.split('\n').length).toEqual(@fileLines.length)

    it 'should be able to swap from beginning to end and keep same number of lines', ->
      # swap 0 to 7
      newText = @fov.getNewFileText(@fileLines, 12, 52, @fileLines.length)
      expect(newText.split('\n').length).toEqual(@fileLines.length)

    it 'should have the same text after a swap back', ->
      # swap 0 to 1
      newText = @fov.getNewFileText(@fileLines, 12, 52, 69)
      # swap 1 to 0
      originalText = @fov.getNewFileText(newText.split('\n'), 29, 69, 12)
      expect(originalText.split('\n').length).toEqual(@fileLines.length)
      expect(originalText).toEqual(@fileText)

    it 'should have the same text after several swaps', ->
      # swap 7 to 0
      newText = @fov.getNewFileText(@fileLines, 144, 161, 12)

      # swap 3 to 7
      newText = @fov.getNewFileText(newText.split('\n'), 86, 97, 160)

      # swap 1 to 3
      newText = @fov.getNewFileText(newText.split('\n'), 29, 69, 101)

      # swap 3 to 1
      newText = @fov.getNewFileText(newText.split('\n'), 61, 101, 29)

      # swap 7 to 3
      newText = @fov.getNewFileText(newText.split('\n'), 149, 160, 86)

      # swap 0 to 7
      originalText = @fov.getNewFileText(newText.split('\n'), 12, 29, 161)
      expect(originalText.split('\n').length).toEqual(@fileLines.length)
      expect(originalText).toEqual(@fileText)

  describe 'nested scenes', ->

    NESTED_SCENE_LIST = [{"line":9,"title":" ACT I","type":"heading1","hasNote":false,"children":[{"line":11,"title":"Meet the players and set up the world. Two hit men with very different lives.","type":"synopsis","hasNote":false,"depth":1},{"line":15,"title":" Meet Scott","type":"heading2","hasNote":false,"children":[{"line":17,"title":"And his friend Baxter.","type":"synopsis","hasNote":false,"depth":2},{"line":19,"title":" Scott's SF Apartment","type":"heading3","hasNote":false,"children":[{"line":21,"title":"INT. SAN FRANCISCO APARTMENT, DAY","type":"scene","hasNote":false,"depth":3},{"line":29,"title":"INT. HALLWAY, SCOTT'S APARTMENT BUILDING, A MOMENT LATER","type":"scene","hasNote":false,"depth":3},{"line":33,"title":".BACK IN THE APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":51,"title":" Baxter's Music Studio","type":"heading3","hasNote":false,"children":[{"line":53,"title":"INT. BAXTER'S SAN FRANCISCO APARTMENT, SAME","type":"scene","hasNote":false,"depth":3},{"line":65,"title":"INT. SCOTT'S APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":128,"title":" Meet Nak","type":"heading2","hasNote":false,"children":[{"line":130,"title":"Nak is the polar opposite of Scott. Razor sharp, disciplined, loves his job.","type":"synopsis","hasNote":false,"depth":2},{"line":132,"title":" Nak's Home","type":"heading3","hasNote":false,"children":[{"line":134,"title":"INT. SAUSALITO HOME, THE NEXT MORNING","type":"scene","hasNote":false,"depth":3},{"line":142,"title":".NAK'S BEDROOM","type":"scene","hasNote":false,"depth":3},{"line":146,"title":"EXT. NAK'S HOUSE, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":150,"title":".A LAND ROVER DEFENDER 90 AND A VOLKSWAGON GTI.","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":156,"title":" Nak's Commute","type":"heading3","hasNote":false,"children":[{"line":158,"title":"EXT. GOLDEN GATE BRIDGE","type":"scene","hasNote":false,"depth":3},{"line":164,"title":"EXT. SAN FRANCISCO BUSINESS DISTRICT, LATER THAT MORNING","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":170,"title":" Nak's Hit","type":"heading3","hasNote":false,"children":[{"line":172,"title":"INT. HOFF AND SPIRNHOLD LOBBY, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":200,"title":"EXT. HOFF AND SPIRNHOLD BUILDING, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":208,"title":"INT. VW GTI, NORTHBOUND ON THE GOLDEN GATE BRIDGE, MINUTES LATER","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":214,"title":" Scott's Hit","type":"heading2","hasNote":false,"children":[{"line":215,"title":" Scott's Morning","type":"heading3","hasNote":false,"children":[{"line":225,"title":"EXT. SCOTT'S APARTMENT, A BIT LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":233,"title":" Palace Hotel","type":"heading3","hasNote":false,"children":[{"line":235,"title":"INT. PALACE HOTEL LOBBY, A BIT LATER","type":"scene","hasNote":false,"depth":3},{"line":241,"title":"INT. PALACE HOTEL RM 412, SAME","type":"scene","hasNote":false,"depth":3},{"line":255,"title":"INT. BATHROOM","type":"scene","hasNote":false,"depth":3},{"line":267,"title":"INT. 4TH FLOOR HALLWAY, SAME","type":"scene","hasNote":false,"depth":3},{"line":273,"title":"INT. RM 412, SAME","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":311,"title":" Scott Visits the Gallery","type":"heading2","hasNote":false,"children":[{"line":313,"title":"INT. LANDCRUISER, DRIVING -- A BIT LATER","type":"scene","hasNote":false,"depth":2},{"line":322,"title":" Scott is Rejected","type":"heading3","hasNote":false,"children":[{"line":324,"title":"INT. SOUTHERN EXPOSURE GALLERY, SOUTH OF MARKET","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":334,"title":" Meet Art Girl","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":372,"title":" The Seed is Planted","type":"heading3","hasNote":false,"children":[{"line":374,"title":"Art Girl gives Scott the idea that he can bribe his way into the gallery and get the exposure he feels is holding back his career as an artist.","type":"synopsis","hasNote":false,"depth":3}],"depth":2}],"depth":1}],"depth":0},{"line":402,"title":" ACT II: A New Day","type":"heading1","hasNote":false,"children":[{"line":403,"title":" The Helo Attack","type":"heading2","hasNote":false,"children":[{"line":405,"title":"INT. SCOTT'S APARTMENT, TWO DAYS LATER","type":"scene","hasNote":false,"depth":2},{"line":411,"title":".SCOTT REENTERING HIS APARTMENT,","type":"scene","hasNote":false,"depth":2},{"line":450,"title":".FROM OUTSIDE THE APARTMENT","type":"scene","hasNote":false,"depth":2},{"line":454,"title":".INSIDE","type":"scene","hasNote":false,"depth":2},{"line":458,"title":".OUTSIDE,","type":"scene","hasNote":false,"depth":2}],"depth":1},{"line":464,"title":" Escape to Baxter's","type":"heading2","hasNote":false,"children":[{"line":466,"title":"INT. BAXTER'S APARTMENT, LATER THAT EVENING","type":"scene","hasNote":false,"depth":2},{"line":470,"title":".AT THE DOOR","type":"scene","hasNote":false,"depth":2},{"line":485,"title":".THE PAIR, DRINKING BEER IN THE LIVING ROOM.","type":"scene","hasNote":false,"depth":2},{"line":489,"title":".ON THE TV","type":"scene","hasNote":false,"depth":2},{"line":543,"title":" Scott Explains His Plan","type":"heading3","hasNote":false,"children":[{"line":545,"title":"...to Baxter and to us.","type":"synopsis","hasNote":false,"depth":3}],"depth":2},{"line":575,"title":" Scott Talks to the Boss","type":"heading3","hasNote":false,"children":[{"line":579,"title":"INT. THE BOSS'S OFFICE, A SECOND LATER","type":"scene","hasNote":false,"depth":3},{"line":588,"title":".SCOTT, IN BAXTER'S KITCHEN","type":"scene","hasNote":false,"depth":3},{"line":634,"title":".THE FINGER","type":"scene","hasNote":false,"depth":3},{"line":638,"title":".SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1}],"depth":0},{"line":669,"title":" ACT III: The Showdown","type":"heading1","hasNote":false,"children":[{"line":670,"title":" Scott and Nak Meet on the Job ##","type":"heading2","hasNote":false,"children":[{"line":671,"title":" Scott's Sniper Plan","type":"heading3","hasNote":false,"children":[{"line":673,"title":"EXT. MARIN HILLSIDE, THE NEXT DAY","type":"scene","hasNote":false,"depth":3},{"line":677,"title":".A SCENIC OVERLOOK","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":689,"title":" Nak Arrives","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":777,"title":" Nak In Action","type":"heading3","hasNote":false,"children":[{"line":786,"title":".UNDER THE CHASSIS OF THE MAZDA,","type":"scene","hasNote":false,"depth":3},{"line":790,"title":".THE MAZDA","type":"scene","hasNote":false,"depth":3},{"line":794,"title":".NAK","type":"scene","hasNote":false,"depth":3},{"line":798,"title":".THE TRUCK","type":"scene","hasNote":false,"depth":3},{"line":802,"title":".SPALDING JEAGER","type":"scene","hasNote":false,"depth":3},{"line":808,"title":".SCOTT","type":"scene","hasNote":false,"depth":3},{"line":812,"title":".SPALDING","type":"scene","hasNote":false,"depth":3},{"line":816,"title":".THE TRUCK SLAMS INTO THE BACK OF THE LEXUS DOING FORTY","type":"scene","hasNote":false,"depth":3},{"line":821,"title":".BACK ON NAK AND SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":843,"title":" Denouement","type":"heading2","hasNote":false,"children":[{"line":845,"title":" Scott's New Life","type":"heading3","hasNote":false,"children":[{"line":847,"title":"Scott is happy in his new life as a painter with a wealthy patron -- who was once his bitter rival.","type":"synopsis","hasNote":false,"depth":3},{"line":849,"title":"INT. SCOTT'S NEW APARTMENT, A FEW DAYS LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":869,"title":" Scott's Life From Now On","type":"heading3","hasNote":false,"children":[{"line":871,"title":"He got the exposure he wanted -- but not at all how he thought he would.","type":"synopsis","hasNote":false,"depth":3}],"depth":2}],"depth":1}],"depth":0}]
    FLATTENED_SCENE_LIST = [{"line":9,"title":" ACT I","type":"heading1","hasNote":false,"children":[{"line":11,"title":"Meet the players and set up the world. Two hit men with very different lives.","type":"synopsis","hasNote":false,"depth":1},{"line":15,"title":" Meet Scott","type":"heading2","hasNote":false,"children":[{"line":17,"title":"And his friend Baxter.","type":"synopsis","hasNote":false,"depth":2},{"line":19,"title":" Scott's SF Apartment","type":"heading3","hasNote":false,"children":[{"line":21,"title":"INT. SAN FRANCISCO APARTMENT, DAY","type":"scene","hasNote":false,"depth":3},{"line":29,"title":"INT. HALLWAY, SCOTT'S APARTMENT BUILDING, A MOMENT LATER","type":"scene","hasNote":false,"depth":3},{"line":33,"title":".BACK IN THE APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":51,"title":" Baxter's Music Studio","type":"heading3","hasNote":false,"children":[{"line":53,"title":"INT. BAXTER'S SAN FRANCISCO APARTMENT, SAME","type":"scene","hasNote":false,"depth":3},{"line":65,"title":"INT. SCOTT'S APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":128,"title":" Meet Nak","type":"heading2","hasNote":false,"children":[{"line":130,"title":"Nak is the polar opposite of Scott. Razor sharp, disciplined, loves his job.","type":"synopsis","hasNote":false,"depth":2},{"line":132,"title":" Nak's Home","type":"heading3","hasNote":false,"children":[{"line":134,"title":"INT. SAUSALITO HOME, THE NEXT MORNING","type":"scene","hasNote":false,"depth":3},{"line":142,"title":".NAK'S BEDROOM","type":"scene","hasNote":false,"depth":3},{"line":146,"title":"EXT. NAK'S HOUSE, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":150,"title":".A LAND ROVER DEFENDER 90 AND A VOLKSWAGON GTI.","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":156,"title":" Nak's Commute","type":"heading3","hasNote":false,"children":[{"line":158,"title":"EXT. GOLDEN GATE BRIDGE","type":"scene","hasNote":false,"depth":3},{"line":164,"title":"EXT. SAN FRANCISCO BUSINESS DISTRICT, LATER THAT MORNING","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":170,"title":" Nak's Hit","type":"heading3","hasNote":false,"children":[{"line":172,"title":"INT. HOFF AND SPIRNHOLD LOBBY, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":200,"title":"EXT. HOFF AND SPIRNHOLD BUILDING, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":208,"title":"INT. VW GTI, NORTHBOUND ON THE GOLDEN GATE BRIDGE, MINUTES LATER","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":214,"title":" Scott's Hit","type":"heading2","hasNote":false,"children":[{"line":215,"title":" Scott's Morning","type":"heading3","hasNote":false,"children":[{"line":225,"title":"EXT. SCOTT'S APARTMENT, A BIT LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":233,"title":" Palace Hotel","type":"heading3","hasNote":false,"children":[{"line":235,"title":"INT. PALACE HOTEL LOBBY, A BIT LATER","type":"scene","hasNote":false,"depth":3},{"line":241,"title":"INT. PALACE HOTEL RM 412, SAME","type":"scene","hasNote":false,"depth":3},{"line":255,"title":"INT. BATHROOM","type":"scene","hasNote":false,"depth":3},{"line":267,"title":"INT. 4TH FLOOR HALLWAY, SAME","type":"scene","hasNote":false,"depth":3},{"line":273,"title":"INT. RM 412, SAME","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":311,"title":" Scott Visits the Gallery","type":"heading2","hasNote":false,"children":[{"line":313,"title":"INT. LANDCRUISER, DRIVING -- A BIT LATER","type":"scene","hasNote":false,"depth":2},{"line":322,"title":" Scott is Rejected","type":"heading3","hasNote":false,"children":[{"line":324,"title":"INT. SOUTHERN EXPOSURE GALLERY, SOUTH OF MARKET","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":334,"title":" Meet Art Girl","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":372,"title":" The Seed is Planted","type":"heading3","hasNote":false,"children":[{"line":374,"title":"Art Girl gives Scott the idea that he can bribe his way into the gallery and get the exposure he feels is holding back his career as an artist.","type":"synopsis","hasNote":false,"depth":3}],"depth":2}],"depth":1}],"depth":0},{"line":11,"title":"Meet the players and set up the world. Two hit men with very different lives.","type":"synopsis","hasNote":false,"depth":1},{"line":15,"title":" Meet Scott","type":"heading2","hasNote":false,"children":[{"line":17,"title":"And his friend Baxter.","type":"synopsis","hasNote":false,"depth":2},{"line":19,"title":" Scott's SF Apartment","type":"heading3","hasNote":false,"children":[{"line":21,"title":"INT. SAN FRANCISCO APARTMENT, DAY","type":"scene","hasNote":false,"depth":3},{"line":29,"title":"INT. HALLWAY, SCOTT'S APARTMENT BUILDING, A MOMENT LATER","type":"scene","hasNote":false,"depth":3},{"line":33,"title":".BACK IN THE APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":51,"title":" Baxter's Music Studio","type":"heading3","hasNote":false,"children":[{"line":53,"title":"INT. BAXTER'S SAN FRANCISCO APARTMENT, SAME","type":"scene","hasNote":false,"depth":3},{"line":65,"title":"INT. SCOTT'S APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":17,"title":"And his friend Baxter.","type":"synopsis","hasNote":false,"depth":2},{"line":19,"title":" Scott's SF Apartment","type":"heading3","hasNote":false,"children":[{"line":21,"title":"INT. SAN FRANCISCO APARTMENT, DAY","type":"scene","hasNote":false,"depth":3},{"line":29,"title":"INT. HALLWAY, SCOTT'S APARTMENT BUILDING, A MOMENT LATER","type":"scene","hasNote":false,"depth":3},{"line":33,"title":".BACK IN THE APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":21,"title":"INT. SAN FRANCISCO APARTMENT, DAY","type":"scene","hasNote":false,"depth":3},{"line":29,"title":"INT. HALLWAY, SCOTT'S APARTMENT BUILDING, A MOMENT LATER","type":"scene","hasNote":false,"depth":3},{"line":33,"title":".BACK IN THE APARTMENT","type":"scene","hasNote":false,"depth":3},{"line":51,"title":" Baxter's Music Studio","type":"heading3","hasNote":false,"children":[{"line":53,"title":"INT. BAXTER'S SAN FRANCISCO APARTMENT, SAME","type":"scene","hasNote":false,"depth":3},{"line":65,"title":"INT. SCOTT'S APARTMENT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":53,"title":"INT. BAXTER'S SAN FRANCISCO APARTMENT, SAME","type":"scene","hasNote":false,"depth":3},{"line":65,"title":"INT. SCOTT'S APARTMENT","type":"scene","hasNote":false,"depth":3},{"line":128,"title":" Meet Nak","type":"heading2","hasNote":false,"children":[{"line":130,"title":"Nak is the polar opposite of Scott. Razor sharp, disciplined, loves his job.","type":"synopsis","hasNote":false,"depth":2},{"line":132,"title":" Nak's Home","type":"heading3","hasNote":false,"children":[{"line":134,"title":"INT. SAUSALITO HOME, THE NEXT MORNING","type":"scene","hasNote":false,"depth":3},{"line":142,"title":".NAK'S BEDROOM","type":"scene","hasNote":false,"depth":3},{"line":146,"title":"EXT. NAK'S HOUSE, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":150,"title":".A LAND ROVER DEFENDER 90 AND A VOLKSWAGON GTI.","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":156,"title":" Nak's Commute","type":"heading3","hasNote":false,"children":[{"line":158,"title":"EXT. GOLDEN GATE BRIDGE","type":"scene","hasNote":false,"depth":3},{"line":164,"title":"EXT. SAN FRANCISCO BUSINESS DISTRICT, LATER THAT MORNING","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":170,"title":" Nak's Hit","type":"heading3","hasNote":false,"children":[{"line":172,"title":"INT. HOFF AND SPIRNHOLD LOBBY, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":200,"title":"EXT. HOFF AND SPIRNHOLD BUILDING, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":208,"title":"INT. VW GTI, NORTHBOUND ON THE GOLDEN GATE BRIDGE, MINUTES LATER","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":130,"title":"Nak is the polar opposite of Scott. Razor sharp, disciplined, loves his job.","type":"synopsis","hasNote":false,"depth":2},{"line":132,"title":" Nak's Home","type":"heading3","hasNote":false,"children":[{"line":134,"title":"INT. SAUSALITO HOME, THE NEXT MORNING","type":"scene","hasNote":false,"depth":3},{"line":142,"title":".NAK'S BEDROOM","type":"scene","hasNote":false,"depth":3},{"line":146,"title":"EXT. NAK'S HOUSE, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":150,"title":".A LAND ROVER DEFENDER 90 AND A VOLKSWAGON GTI.","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":134,"title":"INT. SAUSALITO HOME, THE NEXT MORNING","type":"scene","hasNote":false,"depth":3},{"line":142,"title":".NAK'S BEDROOM","type":"scene","hasNote":false,"depth":3},{"line":146,"title":"EXT. NAK'S HOUSE, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":150,"title":".A LAND ROVER DEFENDER 90 AND A VOLKSWAGON GTI.","type":"scene","hasNote":false,"depth":3},{"line":156,"title":" Nak's Commute","type":"heading3","hasNote":false,"children":[{"line":158,"title":"EXT. GOLDEN GATE BRIDGE","type":"scene","hasNote":false,"depth":3},{"line":164,"title":"EXT. SAN FRANCISCO BUSINESS DISTRICT, LATER THAT MORNING","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":158,"title":"EXT. GOLDEN GATE BRIDGE","type":"scene","hasNote":false,"depth":3},{"line":164,"title":"EXT. SAN FRANCISCO BUSINESS DISTRICT, LATER THAT MORNING","type":"scene","hasNote":false,"depth":3},{"line":170,"title":" Nak's Hit","type":"heading3","hasNote":false,"children":[{"line":172,"title":"INT. HOFF AND SPIRNHOLD LOBBY, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":200,"title":"EXT. HOFF AND SPIRNHOLD BUILDING, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":208,"title":"INT. VW GTI, NORTHBOUND ON THE GOLDEN GATE BRIDGE, MINUTES LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":172,"title":"INT. HOFF AND SPIRNHOLD LOBBY, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":200,"title":"EXT. HOFF AND SPIRNHOLD BUILDING, CONTINUED","type":"scene","hasNote":false,"depth":3},{"line":208,"title":"INT. VW GTI, NORTHBOUND ON THE GOLDEN GATE BRIDGE, MINUTES LATER","type":"scene","hasNote":false,"depth":3},{"line":214,"title":" Scott's Hit","type":"heading2","hasNote":false,"children":[{"line":215,"title":" Scott's Morning","type":"heading3","hasNote":false,"children":[{"line":225,"title":"EXT. SCOTT'S APARTMENT, A BIT LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":233,"title":" Palace Hotel","type":"heading3","hasNote":false,"children":[{"line":235,"title":"INT. PALACE HOTEL LOBBY, A BIT LATER","type":"scene","hasNote":false,"depth":3},{"line":241,"title":"INT. PALACE HOTEL RM 412, SAME","type":"scene","hasNote":false,"depth":3},{"line":255,"title":"INT. BATHROOM","type":"scene","hasNote":false,"depth":3},{"line":267,"title":"INT. 4TH FLOOR HALLWAY, SAME","type":"scene","hasNote":false,"depth":3},{"line":273,"title":"INT. RM 412, SAME","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":215,"title":" Scott's Morning","type":"heading3","hasNote":false,"children":[{"line":225,"title":"EXT. SCOTT'S APARTMENT, A BIT LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":225,"title":"EXT. SCOTT'S APARTMENT, A BIT LATER","type":"scene","hasNote":false,"depth":3},{"line":233,"title":" Palace Hotel","type":"heading3","hasNote":false,"children":[{"line":235,"title":"INT. PALACE HOTEL LOBBY, A BIT LATER","type":"scene","hasNote":false,"depth":3},{"line":241,"title":"INT. PALACE HOTEL RM 412, SAME","type":"scene","hasNote":false,"depth":3},{"line":255,"title":"INT. BATHROOM","type":"scene","hasNote":false,"depth":3},{"line":267,"title":"INT. 4TH FLOOR HALLWAY, SAME","type":"scene","hasNote":false,"depth":3},{"line":273,"title":"INT. RM 412, SAME","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":235,"title":"INT. PALACE HOTEL LOBBY, A BIT LATER","type":"scene","hasNote":false,"depth":3},{"line":241,"title":"INT. PALACE HOTEL RM 412, SAME","type":"scene","hasNote":false,"depth":3},{"line":255,"title":"INT. BATHROOM","type":"scene","hasNote":false,"depth":3},{"line":267,"title":"INT. 4TH FLOOR HALLWAY, SAME","type":"scene","hasNote":false,"depth":3},{"line":273,"title":"INT. RM 412, SAME","type":"scene","hasNote":false,"depth":3},{"line":311,"title":" Scott Visits the Gallery","type":"heading2","hasNote":false,"children":[{"line":313,"title":"INT. LANDCRUISER, DRIVING -- A BIT LATER","type":"scene","hasNote":false,"depth":2},{"line":322,"title":" Scott is Rejected","type":"heading3","hasNote":false,"children":[{"line":324,"title":"INT. SOUTHERN EXPOSURE GALLERY, SOUTH OF MARKET","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":334,"title":" Meet Art Girl","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":372,"title":" The Seed is Planted","type":"heading3","hasNote":false,"children":[{"line":374,"title":"Art Girl gives Scott the idea that he can bribe his way into the gallery and get the exposure he feels is holding back his career as an artist.","type":"synopsis","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":313,"title":"INT. LANDCRUISER, DRIVING -- A BIT LATER","type":"scene","hasNote":false,"depth":2},{"line":322,"title":" Scott is Rejected","type":"heading3","hasNote":false,"children":[{"line":324,"title":"INT. SOUTHERN EXPOSURE GALLERY, SOUTH OF MARKET","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":324,"title":"INT. SOUTHERN EXPOSURE GALLERY, SOUTH OF MARKET","type":"scene","hasNote":false,"depth":3},{"line":334,"title":" Meet Art Girl","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":372,"title":" The Seed is Planted","type":"heading3","hasNote":false,"children":[{"line":374,"title":"Art Girl gives Scott the idea that he can bribe his way into the gallery and get the exposure he feels is holding back his career as an artist.","type":"synopsis","hasNote":false,"depth":3}],"depth":2},{"line":374,"title":"Art Girl gives Scott the idea that he can bribe his way into the gallery and get the exposure he feels is holding back his career as an artist.","type":"synopsis","hasNote":false,"depth":3},{"line":402,"title":" ACT II: A New Day","type":"heading1","hasNote":false,"children":[{"line":403,"title":" The Helo Attack","type":"heading2","hasNote":false,"children":[{"line":405,"title":"INT. SCOTT'S APARTMENT, TWO DAYS LATER","type":"scene","hasNote":false,"depth":2},{"line":411,"title":".SCOTT REENTERING HIS APARTMENT,","type":"scene","hasNote":false,"depth":2},{"line":450,"title":".FROM OUTSIDE THE APARTMENT","type":"scene","hasNote":false,"depth":2},{"line":454,"title":".INSIDE","type":"scene","hasNote":false,"depth":2},{"line":458,"title":".OUTSIDE,","type":"scene","hasNote":false,"depth":2}],"depth":1},{"line":464,"title":" Escape to Baxter's","type":"heading2","hasNote":false,"children":[{"line":466,"title":"INT. BAXTER'S APARTMENT, LATER THAT EVENING","type":"scene","hasNote":false,"depth":2},{"line":470,"title":".AT THE DOOR","type":"scene","hasNote":false,"depth":2},{"line":485,"title":".THE PAIR, DRINKING BEER IN THE LIVING ROOM.","type":"scene","hasNote":false,"depth":2},{"line":489,"title":".ON THE TV","type":"scene","hasNote":false,"depth":2},{"line":543,"title":" Scott Explains His Plan","type":"heading3","hasNote":false,"children":[{"line":545,"title":"...to Baxter and to us.","type":"synopsis","hasNote":false,"depth":3}],"depth":2},{"line":575,"title":" Scott Talks to the Boss","type":"heading3","hasNote":false,"children":[{"line":579,"title":"INT. THE BOSS'S OFFICE, A SECOND LATER","type":"scene","hasNote":false,"depth":3},{"line":588,"title":".SCOTT, IN BAXTER'S KITCHEN","type":"scene","hasNote":false,"depth":3},{"line":634,"title":".THE FINGER","type":"scene","hasNote":false,"depth":3},{"line":638,"title":".SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1}],"depth":0},{"line":403,"title":" The Helo Attack","type":"heading2","hasNote":false,"children":[{"line":405,"title":"INT. SCOTT'S APARTMENT, TWO DAYS LATER","type":"scene","hasNote":false,"depth":2},{"line":411,"title":".SCOTT REENTERING HIS APARTMENT,","type":"scene","hasNote":false,"depth":2},{"line":450,"title":".FROM OUTSIDE THE APARTMENT","type":"scene","hasNote":false,"depth":2},{"line":454,"title":".INSIDE","type":"scene","hasNote":false,"depth":2},{"line":458,"title":".OUTSIDE,","type":"scene","hasNote":false,"depth":2}],"depth":1},{"line":405,"title":"INT. SCOTT'S APARTMENT, TWO DAYS LATER","type":"scene","hasNote":false,"depth":2},{"line":411,"title":".SCOTT REENTERING HIS APARTMENT,","type":"scene","hasNote":false,"depth":2},{"line":450,"title":".FROM OUTSIDE THE APARTMENT","type":"scene","hasNote":false,"depth":2},{"line":454,"title":".INSIDE","type":"scene","hasNote":false,"depth":2},{"line":458,"title":".OUTSIDE,","type":"scene","hasNote":false,"depth":2},{"line":464,"title":" Escape to Baxter's","type":"heading2","hasNote":false,"children":[{"line":466,"title":"INT. BAXTER'S APARTMENT, LATER THAT EVENING","type":"scene","hasNote":false,"depth":2},{"line":470,"title":".AT THE DOOR","type":"scene","hasNote":false,"depth":2},{"line":485,"title":".THE PAIR, DRINKING BEER IN THE LIVING ROOM.","type":"scene","hasNote":false,"depth":2},{"line":489,"title":".ON THE TV","type":"scene","hasNote":false,"depth":2},{"line":543,"title":" Scott Explains His Plan","type":"heading3","hasNote":false,"children":[{"line":545,"title":"...to Baxter and to us.","type":"synopsis","hasNote":false,"depth":3}],"depth":2},{"line":575,"title":" Scott Talks to the Boss","type":"heading3","hasNote":false,"children":[{"line":579,"title":"INT. THE BOSS'S OFFICE, A SECOND LATER","type":"scene","hasNote":false,"depth":3},{"line":588,"title":".SCOTT, IN BAXTER'S KITCHEN","type":"scene","hasNote":false,"depth":3},{"line":634,"title":".THE FINGER","type":"scene","hasNote":false,"depth":3},{"line":638,"title":".SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":466,"title":"INT. BAXTER'S APARTMENT, LATER THAT EVENING","type":"scene","hasNote":false,"depth":2},{"line":470,"title":".AT THE DOOR","type":"scene","hasNote":false,"depth":2},{"line":485,"title":".THE PAIR, DRINKING BEER IN THE LIVING ROOM.","type":"scene","hasNote":false,"depth":2},{"line":489,"title":".ON THE TV","type":"scene","hasNote":false,"depth":2},{"line":543,"title":" Scott Explains His Plan","type":"heading3","hasNote":false,"children":[{"line":545,"title":"...to Baxter and to us.","type":"synopsis","hasNote":false,"depth":3}],"depth":2},{"line":545,"title":"...to Baxter and to us.","type":"synopsis","hasNote":false,"depth":3},{"line":575,"title":" Scott Talks to the Boss","type":"heading3","hasNote":false,"children":[{"line":579,"title":"INT. THE BOSS'S OFFICE, A SECOND LATER","type":"scene","hasNote":false,"depth":3},{"line":588,"title":".SCOTT, IN BAXTER'S KITCHEN","type":"scene","hasNote":false,"depth":3},{"line":634,"title":".THE FINGER","type":"scene","hasNote":false,"depth":3},{"line":638,"title":".SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":579,"title":"INT. THE BOSS'S OFFICE, A SECOND LATER","type":"scene","hasNote":false,"depth":3},{"line":588,"title":".SCOTT, IN BAXTER'S KITCHEN","type":"scene","hasNote":false,"depth":3},{"line":634,"title":".THE FINGER","type":"scene","hasNote":false,"depth":3},{"line":638,"title":".SCOTT","type":"scene","hasNote":false,"depth":3},{"line":669,"title":" ACT III: The Showdown","type":"heading1","hasNote":false,"children":[{"line":670,"title":" Scott and Nak Meet on the Job ##","type":"heading2","hasNote":false,"children":[{"line":671,"title":" Scott's Sniper Plan","type":"heading3","hasNote":false,"children":[{"line":673,"title":"EXT. MARIN HILLSIDE, THE NEXT DAY","type":"scene","hasNote":false,"depth":3},{"line":677,"title":".A SCENIC OVERLOOK","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":689,"title":" Nak Arrives","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":777,"title":" Nak In Action","type":"heading3","hasNote":false,"children":[{"line":786,"title":".UNDER THE CHASSIS OF THE MAZDA,","type":"scene","hasNote":false,"depth":3},{"line":790,"title":".THE MAZDA","type":"scene","hasNote":false,"depth":3},{"line":794,"title":".NAK","type":"scene","hasNote":false,"depth":3},{"line":798,"title":".THE TRUCK","type":"scene","hasNote":false,"depth":3},{"line":802,"title":".SPALDING JEAGER","type":"scene","hasNote":false,"depth":3},{"line":808,"title":".SCOTT","type":"scene","hasNote":false,"depth":3},{"line":812,"title":".SPALDING","type":"scene","hasNote":false,"depth":3},{"line":816,"title":".THE TRUCK SLAMS INTO THE BACK OF THE LEXUS DOING FORTY","type":"scene","hasNote":false,"depth":3},{"line":821,"title":".BACK ON NAK AND SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":843,"title":" Denouement","type":"heading2","hasNote":false,"children":[{"line":845,"title":" Scott's New Life","type":"heading3","hasNote":false,"children":[{"line":847,"title":"Scott is happy in his new life as a painter with a wealthy patron -- who was once his bitter rival.","type":"synopsis","hasNote":false,"depth":3},{"line":849,"title":"INT. SCOTT'S NEW APARTMENT, A FEW DAYS LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":869,"title":" Scott's Life From Now On","type":"heading3","hasNote":false,"children":[{"line":871,"title":"He got the exposure he wanted -- but not at all how he thought he would.","type":"synopsis","hasNote":false,"depth":3}],"depth":2}],"depth":1}],"depth":0},{"line":670,"title":" Scott and Nak Meet on the Job ##","type":"heading2","hasNote":false,"children":[{"line":671,"title":" Scott's Sniper Plan","type":"heading3","hasNote":false,"children":[{"line":673,"title":"EXT. MARIN HILLSIDE, THE NEXT DAY","type":"scene","hasNote":false,"depth":3},{"line":677,"title":".A SCENIC OVERLOOK","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":689,"title":" Nak Arrives","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":777,"title":" Nak In Action","type":"heading3","hasNote":false,"children":[{"line":786,"title":".UNDER THE CHASSIS OF THE MAZDA,","type":"scene","hasNote":false,"depth":3},{"line":790,"title":".THE MAZDA","type":"scene","hasNote":false,"depth":3},{"line":794,"title":".NAK","type":"scene","hasNote":false,"depth":3},{"line":798,"title":".THE TRUCK","type":"scene","hasNote":false,"depth":3},{"line":802,"title":".SPALDING JEAGER","type":"scene","hasNote":false,"depth":3},{"line":808,"title":".SCOTT","type":"scene","hasNote":false,"depth":3},{"line":812,"title":".SPALDING","type":"scene","hasNote":false,"depth":3},{"line":816,"title":".THE TRUCK SLAMS INTO THE BACK OF THE LEXUS DOING FORTY","type":"scene","hasNote":false,"depth":3},{"line":821,"title":".BACK ON NAK AND SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":671,"title":" Scott's Sniper Plan","type":"heading3","hasNote":false,"children":[{"line":673,"title":"EXT. MARIN HILLSIDE, THE NEXT DAY","type":"scene","hasNote":false,"depth":3},{"line":677,"title":".A SCENIC OVERLOOK","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":673,"title":"EXT. MARIN HILLSIDE, THE NEXT DAY","type":"scene","hasNote":false,"depth":3},{"line":677,"title":".A SCENIC OVERLOOK","type":"scene","hasNote":false,"depth":3},{"line":689,"title":" Nak Arrives","type":"heading3","hasNote":false,"children":[],"depth":2},{"line":777,"title":" Nak In Action","type":"heading3","hasNote":false,"children":[{"line":786,"title":".UNDER THE CHASSIS OF THE MAZDA,","type":"scene","hasNote":false,"depth":3},{"line":790,"title":".THE MAZDA","type":"scene","hasNote":false,"depth":3},{"line":794,"title":".NAK","type":"scene","hasNote":false,"depth":3},{"line":798,"title":".THE TRUCK","type":"scene","hasNote":false,"depth":3},{"line":802,"title":".SPALDING JEAGER","type":"scene","hasNote":false,"depth":3},{"line":808,"title":".SCOTT","type":"scene","hasNote":false,"depth":3},{"line":812,"title":".SPALDING","type":"scene","hasNote":false,"depth":3},{"line":816,"title":".THE TRUCK SLAMS INTO THE BACK OF THE LEXUS DOING FORTY","type":"scene","hasNote":false,"depth":3},{"line":821,"title":".BACK ON NAK AND SCOTT","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":786,"title":".UNDER THE CHASSIS OF THE MAZDA,","type":"scene","hasNote":false,"depth":3},{"line":790,"title":".THE MAZDA","type":"scene","hasNote":false,"depth":3},{"line":794,"title":".NAK","type":"scene","hasNote":false,"depth":3},{"line":798,"title":".THE TRUCK","type":"scene","hasNote":false,"depth":3},{"line":802,"title":".SPALDING JEAGER","type":"scene","hasNote":false,"depth":3},{"line":808,"title":".SCOTT","type":"scene","hasNote":false,"depth":3},{"line":812,"title":".SPALDING","type":"scene","hasNote":false,"depth":3},{"line":816,"title":".THE TRUCK SLAMS INTO THE BACK OF THE LEXUS DOING FORTY","type":"scene","hasNote":false,"depth":3},{"line":821,"title":".BACK ON NAK AND SCOTT","type":"scene","hasNote":false,"depth":3},{"line":843,"title":" Denouement","type":"heading2","hasNote":false,"children":[{"line":845,"title":" Scott's New Life","type":"heading3","hasNote":false,"children":[{"line":847,"title":"Scott is happy in his new life as a painter with a wealthy patron -- who was once his bitter rival.","type":"synopsis","hasNote":false,"depth":3},{"line":849,"title":"INT. SCOTT'S NEW APARTMENT, A FEW DAYS LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":869,"title":" Scott's Life From Now On","type":"heading3","hasNote":false,"children":[{"line":871,"title":"He got the exposure he wanted -- but not at all how he thought he would.","type":"synopsis","hasNote":false,"depth":3}],"depth":2}],"depth":1},{"line":845,"title":" Scott's New Life","type":"heading3","hasNote":false,"children":[{"line":847,"title":"Scott is happy in his new life as a painter with a wealthy patron -- who was once his bitter rival.","type":"synopsis","hasNote":false,"depth":3},{"line":849,"title":"INT. SCOTT'S NEW APARTMENT, A FEW DAYS LATER","type":"scene","hasNote":false,"depth":3}],"depth":2},{"line":847,"title":"Scott is happy in his new life as a painter with a wealthy patron -- who was once his bitter rival.","type":"synopsis","hasNote":false,"depth":3},{"line":849,"title":"INT. SCOTT'S NEW APARTMENT, A FEW DAYS LATER","type":"scene","hasNote":false,"depth":3},{"line":869,"title":" Scott's Life From Now On","type":"heading3","hasNote":false,"children":[{"line":871,"title":"He got the exposure he wanted -- but not at all how he thought he would.","type":"synopsis","hasNote":false,"depth":3}],"depth":2},{"line":871,"title":"He got the exposure he wanted -- but not at all how he thought he would.","type":"synopsis","hasNote":false,"depth":3}]

    MOCK_SCENE_LIST = [{id: 1, children:[{id: 2, children:[{id: 3, children:[{id: 4},{id: 5}]},{id: 6, children:[{id: 7},{id: 8}]}]}]}]

    @fov
    @fileText
    @fileLines

    beforeEach ->
      @fov = new FountainOutlineView()
      packagePath = atom.packages.resolvePackagePath('fountain')
      fileToRead = path.join(packagePath, 'spec/test_files/outline-view-tests.fountain')
      @fileText = fs.readFileSync(fileToRead, 'utf8')
      @fileLines = @fileText.split('\n')

    it 'should leave flat list unchanged', ->
      expect(@fov.flatten(SCENE_LIST, [])).toEqual(SCENE_LIST)

    it 'should have proper count of flattened items', ->
      expect(@fov.flatten(MOCK_SCENE_LIST, []).length).toBe(8)

    it 'should be ordered correctly, based on nesting', ->
      flattened = @fov.flatten(MOCK_SCENE_LIST, [])
      expect(flattened[0].id).toBe(1)
      expect(flattened[1].id).toBe(2)
      expect(flattened[2].id).toBe(3)
      expect(flattened[3].id).toBe(4)
      expect(flattened[4].id).toBe(5)
      expect(flattened[5].id).toBe(6)
      expect(flattened[6].id).toBe(7)
      expect(flattened[7].id).toBe(8)

    it 'should be able to flatten massive nested scene list', ->
      expect(@fov.flatten(NESTED_SCENE_LIST, [])).toEqual(FLATTENED_SCENE_LIST)
